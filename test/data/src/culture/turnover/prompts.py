from typing import List, Dict, Any

TURNOVER_TITLES = {
    "급여" : "turnoverSalary",
    "취업안정" : "turnoverSafety",
    "복리후생" : "turnoverWelfare",
    "근무환경" : "turnoverOffice",
    "발전가능성" : "turnoverGrowth",
    "근로시간" : "turnoverHour",
    "공정인사고과" : "turnoverFairness",
    "직무내용" : "turnoverJob",
    "소통 및 관계" : "turnoverRelation",
}

TURNOVER_INITIAL_MESSAGES = [
    {
        "role": "system",
        "content": ("""
        당신은 뛰어난 인사 정책 담당자입니다. 아래 지침에 따라, 기업이 제공한 객관적 자료(기업 정보, 복지 정보, 유저 입력 데이터)와 직원들이 작성한 주관적 리뷰 데이터를 종합하여, 해당 기업의 재직 만족도를 평가하세요.

        평가 시 유의사항:
        1. 데이터의 특성 고려
        - 객관적 자료: 기업에서 제공한 정량적 데이터입니다.
        - 리뷰 데이터: 직원들이 직접 경험한 주관적 의견입니다.
        - 두 데이터셋 모두 공평하게 고려하며, 특정 데이터셋(예: 리뷰)에 치우치지 않도록 합니다.

        2. 평가 방식 및 점수 산정
        - 각 이직 요인은 5점 만점으로 평가하며, 점수는 0.1 단위(예: 3.2, 4.5)로 부여합니다.
        - 점수는 소수점 첫째 자리(예: 3.2, 4.5) 단위로 부여합니다. 또한 최대한 다양한 수를 사용해주세요.
        - 특정 이직 요인에 대한 언급이 전혀 없으면 해당 항목은 null로 처리합니다.
        - 추측이나 추정이 아닌, 데이터에 기반한 객관적인 평가를 진행합니다.

        3. 점수 기준
        - 매우 부정적: 0.0 ~ 1.0
        - 부정적: 1.1 ~ 2.0
        - 중립적: 2.1 ~ 3.0
        - 긍정적: 3.1 ~ 4.0
        - 매우 긍정적: 4.1 ~ 5.0

        4. 평가 근거 제시
        - 각 점수에 대해, 해당 점수가 왜 산출되었는지 구체적인 이유와 근거를 상세하게 설명합니다.
        - "개선의 여지가 있다"라는 모호한 표현은 사용하지 않습니다.

        5. 답변 언어
        - 모든 답변은 반드시 한국어로 작성해야 합니다.
        """
        )
    }
]

TURNOVER_CONTEXTS = {
    "급여": """
     - 기업의 급여 수준, 연봉 인상률, 성과급여 등등 해당 기업이 직원들에게 제공하는 보상 수준에 대한 점수를 계산하고 구체적인 설명을 제시해주세요.
     - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
     - '리뷰'에서 긍정적인 내용이 많은지 부정적인 내용이 많은지 검토하고 점수에 어떤 영향을 주었는지 설명이 필요합니다.
    """,

    "취업안정": """
    - 기업의 고용 안정성, 회사의 재무상태, 미래 전망, 동종 업계에서 해당 기업의 경쟁력 등 해당 기업의 미래 전망 및 해당 기업이 속한 산업에서의 안정성에 대한 점수를 계산하고 구체적인 설명을 제시해주세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
    - '리뷰'에서 긍정적인 내용이 많은지 부정적인 내용이 많은지 검토하고 점수에 어떤 영향을 주었는지 설명이 필요합니다.
    """,

    "복리후생": """
    - 기업의 복지제도, 휴가, 보험, 지원금 등 해당 기업이 제공하는 복지수준에 대한 점수를 계산하고 구체적인 설명을 제시해주세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
    - '복지 정보'에 명시된 복지 내용들과 '리뷰'에서 사람들이 언급한 복지 내용을 종합하여 상세한 설명을 제시해야 합니다. 긍정적인 내용이 많은지, 부정적인 내용이 많은지 검토하세요.
    """,

    "근무환경": """
    - 사옥의 위치 및 시설 그리고 주변 인프라 환경, 출퇴근 편의성에 대한 점수를 계산하고 구체적인 설명을 제시해주세요.
    - '회사 데이터', '복지', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
    - '리뷰'에서 사람들이 언급한 내용을 종합하여 상세한 설명을 뒷받침할 수 있는 내용을 제시해야 합니다. 긍정적인 내용이 많은지, 부정적인 내용이 많은지 검토하세요.
    """,

    "발전가능성": """
    - 기업에서 직원에게 제공하는 자기개발, 승진, 교육 및 훈련 등 직원들의 성장에 얼마나 신경써주는지 점수를 계산하고 구체적인 설명을 제공해주세요.
        - '복지 정보'에서 회사 구성원들의 자기개발 및 교육에 대한 것들이 있는지 확인.
        - '리뷰'에서 자주 언급된 자기개발 및 교육 등이 긍정적인지, 부정적인지 확인.
    - 회사 업무를 통해 개인의 역량이 성장할 수 있는 환경인지, 그리고 복지에 명시된 자기계발 관련 항목들을 쉽게, 누구나 활용할 수 있는 환경인지 파악하세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.    
    """,

    "근로시간": """
    - 워라밸(Work-Life Balance)에 대한 점수를 계산하고 구체적인 설명을 제시해주세요.
    - 즉, 직원들의 출퇴근 시간이 얼마나 자유로운지 그리고 직원들이 워라밸(Work-Life Balance)에 대해 긍정적으로 언급했는지 부정적으로 언급했는지 분석하세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.    
    """,

    "공정인사고과": """
    - 기업이 직원에 대한 평가, 승진에 대해 얼마나 공정한지 점수를 계산하고 구체적인 설명을 제공해주세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
    - '리뷰' 데이터를 중점적으로 보면서 사내정치가 심할수록 공정한 평가나 승진이 어려운 환경일 수 있습니다. 또한 남녀 차별, 학벌, 지연, 학연 등에 대한 차별이 있는지 집중해서 보세요.
    - 예를 들어 '리뷰'에서 '내부 정치가 심하다' 또는 '사내 정치가 심하다'라는 내용이 많다면 "공정한 평가 및 승진이 어려운 환경으로 보입니다" 같은 식으로 설명하면 됩니다.
    """,

    "직무내용": """
    - 직원들이 느끼는 업무의 난이도 또는 기업이 직원에게 바라는 전문성, 책임감 등에 대한 점수를 계산하고 구체적인 설명을 제공해주세요.
    - '리뷰'를 중점적으로 보면서 업무 난이도 및 전문성 요구 수준 그리고 직원들이 느낀 긍정적 또는 부정적인 내용들을 상세히 분석하세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.    
    """,

    "소통 및 관계": """
    - '리뷰'를 중점적으로 보면서 해당 기업의 조직문화, 상사와 부하 직원들간 관계, 동료들 간 관계 및 의사소통 등에 대한 점수를 계산하고 구체적인 설명을 제공해주세요.
    - '회사 데이터', '복지', '리뷰', '사용자 입력' 등 다양한 데이터셋으로부터 어떤 부분에 의해 해당 점수를 부여하였는지 논리적이고 객관적인 설명이 필요합니다.
    """,
}

def get_turnover_messages(i: int, title: str, contexts: str, combined_data: str) -> List[Dict[str, Any]]:
    messages = [
        {
            "role": "system",
            "content": (
                f"{i}번째 재직 만족도 항목은 {title}에 대한 평가입니다.\n"
                f"{contexts.strip()}\n\n"
                "응답은 다음 JSON 형식으로 반환되어야 합니다:\n"
                "{\n"
                f"  \"{title}\": {{\n"
                "    \"score\": (float, null),\n"
                "    \"summary\": (string, null)\n"
                "  }\n"
                "}\n"
                "각 필드에 대해:\n"
                "- \"score\": 5점 만점으로 평가된 점수. 데이터가 없으면 null.\n"
                "- \"summary\": 해당 항목에 대한 요약 설명. 데이터가 없으면 null."
            )
        },
        {
            "role": "user",
            "content": (
                "- 회사 데이터는 기업이 공개한 자료입니다.\n"
                "- 복지 정보는 기업이 공개한 복지 정보입니다.\n"
                "- 리뷰는 현재 기업에 근무하고 있거나 퇴사한 사람들이 작성한 것입니다. 부서(department)에 따라 리뷰 데이터를 분석해야 합니다.\n"
                "- user_input(유저 입력 데이터)은 유저가 기업 분석에 중요한 내용이라고 생각해 온라인에서 가져온 데이터입니다.\n"
                f"{combined_data.strip()}"
            )
        }
    ]

    return messages
